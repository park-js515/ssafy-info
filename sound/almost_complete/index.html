<!DOCTYPE html>
<html>
<head>
  <title>음성 녹음</title>
</head>
<body>
  <h1>음성 녹음</h1>
  <button id="startButton">음성 녹음 시작</button>
  <button id="stopButton">음성 녹음 종료</button>
  <button id="saveButton">텍스트 저장</button>
  <div id="transcription"></div>

  <script>
    let recognition;
    let transcription = '';
    let isRecording = false;

    const startButton = document.getElementById('startButton');
    const stopButton = document.getElementById('stopButton');
    const saveButton = document.getElementById('saveButton');
    const transcriptionDiv = document.getElementById('transcription');

    const startSpeechRecognition = () => {
      recognition = new webkitSpeechRecognition();
      recognition.lang = 'ko-KR';

      recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        transcription += transcript + ' '; // 중간에 멈추더라도 계속 누적
        transcriptionDiv.innerText = transcription;
      };

      recognition.onend = () => {
        if (isRecording) {
          startSpeechRecognition();
        }
      };

      recognition.start();
      isRecording = true;
      startButton.disabled = true;
      stopButton.disabled = false;
      saveButton.disabled = true;
    };

    const stopSpeechRecognition = () => {
      if (recognition) {
        recognition.stop();
        isRecording = false;
        startButton.disabled = false;
        stopButton.disabled = true;
        saveButton.disabled = false;
      }
    };

    const saveTranscription = () => {
      const textToSave = transcription.trim();
      if (textToSave) {
        const blob = new Blob([textToSave], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'recorded_text.txt';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
      }
    };

    startButton.addEventListener('click', startSpeechRecognition);
    stopButton.addEventListener('click', stopSpeechRecognition);
    saveButton.addEventListener('click', saveTranscription);
  </script>
</body>
</html>
